# トキワシティ訓練所 トラブルシューティングガイド

## 🚨 起動が止まる問題の解決方法

### 問題の症状
- 「トキワシティ訓練所を起動中... しばらくお待ちください」で止まる
- 前回のログイン情報が残っている
- セッション情報が正しくクリアされない

### 🔧 解決手順

#### 1. ブラウザのキャッシュとローカルストレージをクリア

**Chrome/Edge:**
1. F12キーを押して開発者ツールを開く
2. Applicationタブをクリック
3. Storage → Local Storage → サイトのURLを選択
4. すべての項目を削除
5. Session Storageも同様にクリア
6. Cookiesも削除

**Firefox:**
1. F12キーを押して開発者ツールを開く
2. Storageタブをクリック
3. Local Storage → サイトのURLを選択
4. すべての項目を削除
5. Session Storageも同様にクリア

#### 2. ハードリフレッシュ
- **Windows:** Ctrl + F5
- **Mac:** Cmd + Shift + R

#### 3. シークレット/プライベートモードで試行
- 新しいシークレットウィンドウでアプリケーションを開く
- これにより古いセッション情報の影響を受けない

#### 4. 環境変数の確認
`.env.local`ファイルに以下が正しく設定されているか確認：

```bash
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

#### 5. データベースの初期化
Supabaseプロジェクトが正しく設定されているか確認：

```bash
# クイックスタートスクリプトを実行
npm run quick-start
```

または手動でSupabaseダッシュボードから：
1. SQL Editorを開く
2. `setup-database-now.sql`の内容をコピー&ペースト
3. 実行

### 🐛 開発者向けデバッグ

#### コンソールログの確認
1. F12キーで開発者ツールを開く
2. Consoleタブでエラーメッセージを確認
3. 以下のようなログが表示されるか確認：
   ```
   🔐 AuthProvider: 初期化開始
   🔐 AuthProvider: 古いセッション情報をクリアしました
   🔐 AuthProvider: 初期化完了、isLoadingをfalseに設定
   ```

#### ネットワークタブの確認
1. NetworkタブでAPIリクエストの状況を確認
2. Supabaseへの接続が成功しているか確認
3. エラーが発生している場合は詳細を確認

### 🔄 自動修復機能

アプリケーションには以下の自動修復機能が組み込まれています：

1. **セッション自動クリア**: 起動時に古いセッション情報を自動的にクリア
2. **フォールバック認証**: Supabaseが利用できない場合はローカル認証に自動切り替え
3. **エラーハンドリング**: 認証エラーが発生した場合の適切な処理

### 📱 モバイルでの問題

モバイルブラウザで問題が発生する場合：

1. **アプリの再インストール**: ホーム画面から削除して再追加
2. **ブラウザの更新**: 最新バージョンに更新
3. **キャッシュクリア**: ブラウザ設定からキャッシュをクリア

### 🆘 問題が解決しない場合

1. **GitHub Issues**: 問題の詳細を報告
2. **ログファイル**: エラーログを添付
3. **環境情報**: OS、ブラウザ、Node.jsバージョンを記載

### 📋 予防策

- 定期的にブラウザのキャッシュをクリア
- 開発環境では定期的に`npm run dev`を再起動
- 本番環境では適切なセッション管理設定を行う

---

**注意**: このガイドは開発環境での問題解決を目的としています。本番環境では適切なセキュリティ設定を行ってください。
